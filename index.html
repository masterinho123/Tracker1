<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habit Tracker - Sync</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Recharts dependencies -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    
    <!-- Supabase for direct sync (GitHub Pages) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gray: {
                            50: '#f9fafb', 100: '#f3f4f6', 200: '#e5e7eb', 300: '#d1d5db', 400: '#9ca3af',
                            500: '#6b7280', 600: '#4b5563', 700: '#374151', 800: '#1f2937', 900: '#111827',
                        },
                        green: { 400: '#4ade80', 500: '#22c55e' }
                    }
                }
            }
        }

        // Inline translations for index.html (before app.js loads)
        const lang = localStorage.getItem('tracker_language') || 'it';
        const indexMsgs = {
            it: { loading: "Caricamento del tracker... Se la pagina rimane bianca, verifica la console (F12).", error: "Errore nel caricamento di app.js" },
            en: { loading: "Loading tracker... If the page stays white, check the console (F12).", error: "Error loading app.js" },
            fr: { loading: "Chargement du tracker... Si la page reste blanche, vérifiez la console (F12).", error: "Erreur lors du chargement de app.js" },
            de: { loading: "Tracker wird geladen... Wenn die Seite weiß bleibt, prüfe die Konsole (F12).", error: "Fehler beim Laden von app.js" }
        };
        window.INDEX_T = indexMsgs[lang] || indexMsgs.it;
    </script>
    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body {
            background: #0f172a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }
    </style>
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div id="root">
        <div id="loading-message" style="color: white; text-align: center; margin-top: 50px;">
            <script>document.write(window.INDEX_T.loading);</script>
        </div>
    </div>

    <!-- App Logic -->
    <script type="text/babel" data-presets="env,react">
        window.APP_BASE_PATH = window.location.pathname;
    </script>
    <script type="text/babel" data-presets="env,react" src="app.js?v=32" onerror="alert(window.INDEX_T.error)"></script>
    
    <script>
        window.addEventListener('load', () => {
            if ('serviceWorker' in navigator) {
                const swPath = window.location.pathname.endsWith('/') 
                    ? window.location.pathname + 'sw.js'
                    : window.location.pathname + '/sw.js';
                
                navigator.serviceWorker.register(swPath.replace('//', '/')).catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            }
        });
    </script>
</body>
</html>